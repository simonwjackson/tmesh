#!/usr/bin/env bash

SCRIPT_DIR="$(dirname "$0")"
TMESH_SERVER_INSTANCE_SOCKET=${TMESH_SERVER_INSTANCE_SOCKET:-"workspace"}
TMUX_CONFIG=${TMUX_CONFIG:="${SCRIPT_DIR}/../etc/tmesh/tmesh-server.tmux.conf"}
# nvim -c "terminal" -c "startinsert" >/dev/null 2>&1

tmux \
  -L "${TMESH_SERVER_INSTANCE_SOCKET}" \
  -f "${TMUX_CONFIG}" \
  attach-session \
  -t terminals ||
  tmux \
    -L "${TMESH_SERVER_INSTANCE_SOCKET}" \
    -f "${TMUX_CONFIG}" \
    new-session \
    -s terminals \
    "${SHELL}"
